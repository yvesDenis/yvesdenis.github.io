<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Build, deploy and run an application with ECR, ECS and Codebuild (Part 2) | Time-to-Geek</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Introduction This is the second part of our project including ECS, ECR, Codebuild, github actions. You can find the first part here.
This part will focus more on the deployment of our application (its container image), the unit tests executed by Codebuild at each push in github and finally we can test through our web browser if our application responds as expected.
The source code of the whole project : https://github."><meta name=generator content="Hugo 0.108.0"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.98b8feee71ad3d56ea881041d877c631e7268369636aa10acbcb1c7f3bd3ea41.css><meta property="og:title" content="Build, deploy and run an application with ECR, ECS and Codebuild (Part 2)"><meta property="og:description" content="Introduction This is the second part of our project including ECS, ECR, Codebuild, github actions. You can find the first part here.
This part will focus more on the deployment of our application (its container image), the unit tests executed by Codebuild at each push in github and finally we can test through our web browser if our application responds as expected.
The source code of the whole project : https://github."><meta property="og:type" content="article"><meta property="og:url" content="https://yvesdenis.github.io/post/ecs-ecr-codebuild-part-2-post/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-12-18T11:20:08-04:00"><meta property="article:modified_time" content="2022-12-18T11:20:08-04:00"><meta property="og:site_name" content="Time-to-Geek"><meta itemprop=name content="Build, deploy and run an application with ECR, ECS and Codebuild (Part 2)"><meta itemprop=description content="Introduction This is the second part of our project including ECS, ECR, Codebuild, github actions. You can find the first part here.
This part will focus more on the deployment of our application (its container image), the unit tests executed by Codebuild at each push in github and finally we can test through our web browser if our application responds as expected.
The source code of the whole project : https://github."><meta itemprop=datePublished content="2022-12-18T11:20:08-04:00"><meta itemprop=dateModified content="2022-12-18T11:20:08-04:00"><meta itemprop=wordCount content="392"><meta itemprop=keywords content="Aws,IAC,DevOps,Cloud,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Build, deploy and run an application with ECR, ECS and Codebuild (Part 2)"><meta name=twitter:description content="Introduction This is the second part of our project including ECS, ECR, Codebuild, github actions. You can find the first part here.
This part will focus more on the deployment of our application (its container image), the unit tests executed by Codebuild at each push in github and finally we can test through our web browser if our application responds as expected.
The source code of the whole project : https://github."></head><body class="ma0 avenir bg-near-white production"><header class="cover bg-top" style=background-image:url(https://yvesdenis.github.io/images/aws_terraform.png)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Time-to-Geek</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/post/ title="Articles page">Articles</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/contact/ title="Contact page">Contact</a></li></ul><div class=ananke-socials><a href=https://github.com/yvesDenis target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">Build, deploy and run an application with ECR, ECS and Codebuild (Part 2)</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">ARTICLES</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Build, deploy and run an application with ECR, ECS and Codebuild (Part 2)</h1><p class=tracked>By <strong>Yves Denis Deffo</strong></p><time class="f6 mv4 dib tracked" datetime=2022-12-18T11:20:08-04:00>December 18, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h2 id=introduction>Introduction</h2><p>This is the second part of our project including ECS, ECR, Codebuild, github actions. You can find the first part <a href=https://yvesdenis.github.io/post/ecs-ecr-codebuild-part-1-post/>here</a>.</p><p>This part will focus more on the deployment of our application (its container image), the unit tests executed by Codebuild at each push in github and finally we can test through our web browser if our application responds as expected.</p><p>The source code of the whole project : <a href=https://github.com/yvesDenis/website-projects-articles/tree/master/deploy-app-aws-ecs>https://github.com/yvesDenis/website-projects-articles/tree/master/deploy-app-aws-ecs</a></p><h2 id=architecture-diagram>Architecture diagram</h2><p><img src=/images/ecs-ecr/codebuild-ecr-ecs-project-deploy.svg alt="ecs,codebuild and ecr call diagram"></p><p>The diagram above should be the production status of our infrastructure. Our ECS cluster will be deployed on two private subnets in which will be the autoscaling group , which with the help of a launchTemplate, will instantiate a pair of EC2s which will be the receptacle of the ecs tasks.</p><h2 id=github-workflow>Github workflow</h2><p>Before testing all these beautiful people. One of our goals at the beginning of this project was to stay close to a real-world situation. So we decided to automate our unit tests via Codebuild and the update of our image in the AWS ECR remote repository.</p><p>Here&rsquo;s the diagram of our Gitops pipeline.</p><p><img src=/images/ecs-ecr/build-deploy-aws-ecs.drawio.png alt="Github workflow"></p><p>AWS has provided a starter GitHub workflow that takes advantage of the AWS open-source GitHub Actions to build and deploy containers on ECS for each commit to master branch of the repository.</p><p><a href=https://docs.github.com/en/actions/deployment/deploying-to-your-cloud-provider/deploying-to-amazon-elastic-container-service>https://docs.github.com/en/actions/deployment/deploying-to-your-cloud-provider/deploying-to-amazon-elastic-container-service</a></p><p>This github workflow contains just a single job whose first step is to query the status of unit tests that have been run in codebuild.</p><p><img src=/images/ecs-ecr/codebuild_build_history_success.png alt="codebuild build history success"></p><p>Our codebuild project sends unit test status report to Github asynchronously.</p><p><img src=/images/ecs-ecr/codebuild_report_build_status.png alt="codebuild report build status"></p><p>Once the unit tests status is positive. Our pipeline, after retrieving temporary credentials, will build our application and build the docker image that will later be pushed into ECR by tagging our image with the commit ID.</p><p><img src=/images/ecs-ecr/ecr_repo_name.png alt="ECR repo name"></p><p><img src=/images/ecs-ecr/ecr_base_repo.png alt="ECR base repo"></p><p>The image being present in the repository, we can update the ECS task definition and redeploy the image in ECS.</p><p><img src=/images/ecs-ecr/ecs_base_app_cluster_service.png alt="ECR base app cluster service"></p><p><img src=/images/ecs-ecr/ecs_base_app_task.png alt="ECR base app task"></p><h2 id=integration-test>Integration test</h2><p>During the first part of this article, we deployed our ECS cluster with the autoscaling group and the application load balancer which is directly connected with the Internet Gateway.
To test our application, we will need the domain name of the ALB.</p><p><img src=/images/ecs-ecr/alb_domain_name.png alt="ALB domain name"></p><p>After launching this request via the browser: <a href=https://base-app-alb-1758938518-ca-central-1.elb.amazonaws.com/hello>https://base-app-alb-1758938518-ca-central-1.elb.amazonaws.com/hello</a></p><p>We should get this result:</p><p><img src=/images/ecs-ecr/base_app_test_result.png alt="Base app test result"></p><h2 id=conclusion>Conclusion</h2><p>This project, which was done in two parts, covered the complete production cycle of an application in the cloud.
Let me know in the comments what you think 😉</p><ul class=pa0><li class="list di"><a href=/tags/aws/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Aws</a></li><li class="list di"><a href=/tags/iac/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">IAC</a></li><li class="list di"><a href=/tags/devops/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">DevOps</a></li><li class="list di"><a href=/tags/cloud/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Cloud</a></li></ul><div class=addthis_inline_share_toolbox></div><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script"),n="https-yvesdenis-github-io";t.src="https://"+n+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">What's in this post</p><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#architecture-diagram>Architecture diagram</a></li><li><a href=#github-workflow>Github workflow</a></li><li><a href=#integration-test>Integration test</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/post/ecs-ecr-codebuild-part-1-post/>Build, deploy and run an application with ECR, ECS and Codebuild (Part 1)</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://yvesdenis.github.io/>&copy; Time-to-Geek 2022</a><div><div class=ananke-socials><a href=https://github.com/yvesDenis target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer><script id=dsq-count-scr src=//https-yvesdenis-github-io.disqus.com/count.js async></script>
<script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-6382ff1e2fa5e2f7"></script></body></html>